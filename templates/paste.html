{% extends "base.html" %}
{% block title %}{{ paste.title }} – Cobblepaste{% endblock %}

{% block content %}
<section class="cp-card">
  <header class="cp-paste-header">
    <div>
      <h1>{{ paste.title }}</h1>
      <p class="cp-meta">
        by <strong>{{ paste.author }}</strong> •
        created {{ paste.created_at.strftime("%Y-%m-%d") }}
      </p>
    </div>

    {% if paste.competitive_mode %}
    <div class="cp-competitive-badge">
      Competitive Mode enabled — EVs & IVs hidden
    </div>
    {% endif %}

    <div class="cp-link" onclick="copyShareLink()">
      <span>Share URL:</span>
      <code id="share-url">{{ request.url }}</code>
    </div>
  </header>

  {% if paste.notes %}
  <section class="cp-notes">
    <h2>Notes</h2>
    <p>{{ paste.notes | e | replace('\n','<br>')|safe }}</p>
  </section>
  {% endif %}

  <section class="cp-team-grid">
    {% for mon in team %}
    <article class="cp-mon-card">
      <div class="cp-mon-header">
        <img
          class="cp-mon-sprite"
          src="https://cobblemon.tools/pokedex/pokemon/{{ mon.sprite_name }}/sprite.png"
          alt="{{ mon.species }}"
          onerror="this.style.display='none';"
        />
        <div>
          <h2>
            {% if mon.nickname %}
              {{ mon.nickname }} <span class="cp-species">({{ mon.species }})</span>
            {% else %}
              {{ mon.species }}
            {% endif %}
          </h2>

          {% if mon.item %}
          <p class="cp-item">@ {{ mon.item }}</p>
          {% endif %}

          <p class="cp-ability">Ability: {{ mon.ability or "—" }}</p>
        </div>
      </div>

      <div class="cp-mon-body">

        <div class="cp-mon-stats">
          {% if mon.nature %}
          <p><strong>Nature:</strong> {{ mon.nature }}</p>
          {% endif %}
          {% if mon.tera_type %}
          <p><strong>Tera Type:</strong> {{ mon.tera_type }}</p>
          {% endif %}

          {% if not paste.competitive_mode %}
          <div class="cp-stat-pair">

            {% if mon.evs %}
            <div class="cp-stat-grid stat-fixed">
              <p class="cp-stat-title">EVs</p>
              {% for stat, value in mon.evs.items() %}
              <div class="cp-stat-row">
                <span class="cp-stat-name">{{ stat }}</span>
                <span class="cp-stat-value">{{ value }}</span>
              </div>
              {% endfor %}
            </div>
            {% endif %}

            {% if mon.ivs %}
            <div class="cp-stat-grid stat-fixed">
              <p class="cp-stat-title">IVs</p>
              {% for stat, value in mon.ivs.items() %}
              <div class="cp-stat-row">
                <span class="cp-stat-name">{{ stat }}</span>
                <span class="cp-stat-value">{{ value }}</span>
              </div>
              {% endfor %}
            </div>
            {% endif %}

          </div>
          {% endif %}
        </div>

        <!-- MOVES IN 2x2 GRID -->
        <div class="cp-move-grid">
          {% for move in mon.moves %}
          <div class="cp-move-cell">
            {{ move }}
          </div>
          {% endfor %}
        </div>

      </div>
    </article>
    {% endfor %}
  </section>
</section>

<style>
/* EVs + IVs same size */
.stat-fixed {
  width: 140px;
  min-height: 160px;
}

/* Keep EVs & IVs side by side */
.cp-stat-pair {
  display: flex;
  gap: 12px;
}

/* EV/IV GRID STYLE */
.cp-stat-grid {
  margin-top: 6px;
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 10px;
  padding: 10px;
  background: rgba(255,255,255,0.04);
}

.cp-stat-title {
  font-weight: 600;
  margin-bottom: 8px;
  text-transform: uppercase;
  font-size: 0.75rem;
  color: #8ecaff;
}

.cp-stat-row {
  display: flex;
  justify-content: space-between;
  padding: 2px 0;
  font-size: 0.85rem;
}

/* MOVE GRID (2x2, square-like blocks) */
.cp-move-grid {
  margin-top: 14px;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
}

.cp-move-cell {
  padding: 10px 6px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 8px;
  text-align: center;
  font-size: 0.85rem;
  font-weight: 500;
  color: #d9e9ff;
  min-height: 38px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.cp-move-cell:hover {
  background: rgba(255,255,255,0.12);
  border-color: rgba(255,255,255,0.2);
}

/* prevents stretching */
.cp-mon-body {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
</style>

<script>
function copyShareLink() {
    const urlText = document.getElementById("share-url").innerText;
    navigator.clipboard.writeText(urlText).then(() => {
        const codeEl = document.getElementById("share-url");
        codeEl.classList.add("copied");
        setTimeout(() => { codeEl.classList.remove("copied"); }, 800);
    });
}
</script>

{% endblock %}
