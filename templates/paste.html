{% extends "base.html" %}
{% block title %}{{ paste.title }} – Cobblepaste{% endblock %}

{% block content %}
<section class="cp-card">
  <header class="cp-paste-header">
    <div>
      <h1>{{ paste.title }}</h1>
      <p class="cp-meta">
        by <strong>{{ paste.author }}</strong> •
        created {{ paste.created_at.strftime("%Y-%m-%d") }}
      </p>
    </div>

    {% if paste.competitive_mode %}
    <div class="cp-competitive-badge">
      Competitive Mode enabled — EVs & IVs hidden
    </div>
    {% endif %}

    <div class="cp-link" onclick="copyShareLink()">
      <span>Share URL:</span>
      <code id="share-url">{{ request.url }}</code>
    </div>
  </header>

  {% if paste.notes %}
  <section class="cp-notes">
    <h2>Notes</h2>
    <p>{{ paste.notes | e | replace('\n','<br>')|safe }}</p>
  </section>
  {% endif %}

  <section class="cp-team-grid">
    {% for mon in team %}
    <article class="cp-mon-card">
      <div class="cp-mon-header">
        <img
          class="cp-mon-sprite"
          src="https://cobblemon.tools/pokedex/pokemon/{{ mon.sprite_name }}/sprite.png"
          alt="{{ mon.species }}"
          onerror="this.style.display='none';"
        />
        <div>
          <h2>
            {% if mon.nickname %}
              {{ mon.nickname }} <span class="cp-species">({{ mon.species }})</span>
            {% else %}
              {{ mon.species }}
            {% endif %}
          </h2>
          {% if mon.item %}
          <p class="cp-item">@ {{ mon.item }}</p>
          {% endif %}
          <p class="cp-ability">Ability: {{ mon.ability or "—" }}</p>
        </div>
      </div>

      <div class="cp-mon-body">

        <div class="cp-mon-stats">

          {% if mon.nature %}
          <p><strong>Nature:</strong> {{ mon.nature }}</p>
          {% endif %}
          {% if mon.tera_type %}
          <p><strong>Tera Type:</strong> {{ mon.tera_type }}</p>
          {% endif %}

          {% if not paste.competitive_mode %}
          {% if mon.evs %}
          <div class="cp-stat-grid">
            <p class="cp-stat-title">EVs</p>
            {% for stat, value in mon.evs.items() %}
            <div class="cp-stat-row">
              <span class="cp-stat-name">{{ stat }}</span>
              <span class="cp-stat-value">{{ value }}</span>
            </div>
            {% endfor %}
          </div>
          {% endif %}

          {% if mon.ivs %}
          <div class="cp-stat-grid">
            <p class="cp-stat-title">IVs</p>
            {% for stat, value in mon.ivs.items() %}
            <div class="cp-stat-row">
              <span class="cp-stat-name">{{ stat }}</span>
              <span class="cp-stat-value">{{ value }}</span>
            </div>
            {% endfor %}
          </div>
          {% endif %}
          {% endif %}

        </div>

        <ul class="cp-moves">
          {% for move in mon.moves %}
          <li>{{ move }}</li>
          {% endfor %}
        </ul>

      </div>
    </article>
    {% endfor %}
  </section>
</section>

<style>
.cp-stat-grid {
  margin-top: 8px;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px;
  padding: 8px 10px;
  background: rgba(255,255,255,0.04);
}

.cp-stat-title {
  font-weight: 600;
  margin-bottom: 6px;
  text-transform: uppercase;
  font-size: 0.75rem;
  color: #8ecaff;
  letter-spacing: 0.5px;
}

.cp-stat-row {
  display: flex;
  justify-content: space-between;
  padding: 2px 0;
  font-size: 0.85rem;
}

.cp-stat-name {
  opacity: 0.85;
}

.cp-stat-value {
  font-weight: 600;
}
</style>

<script>
function copyShareLink() {
    const urlText = document.getElementById("share-url").innerText;

    navigator.clipboard.writeText(urlText).then(() => {
        const codeEl = document.getElementById("share-url");
        codeEl.classList.add("copied");

        setTimeout(() => {
            codeEl.classList.remove("copied");
        }, 800);
    });
}
</script>

{% endblock %}
